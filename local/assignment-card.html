<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-styles/typography.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../eq-form/eq-form.html">

<dom-module id="assignment-card">
  <template>
    <style include="iron-flex iron-flex-alignment iron-flex-factors">
      :host {
        display: block;
        @apply(--paper-font-subhead);
        @apply(--layout-vertical);
        border-bottom:1px solid #efefef;
      }

      .idNo {
        padding:5px;
      }
      .pad {
        padding:5px;
        cursor: pointer; 
        cursor: hand; 
      }
      .pad:hover {
        padding:5px;
        background:#efefef;
      }
    </style>
   
    <div class="layout horizontal pad" on-tap="_tap">
      <span class="flex-1">{{data.key.8}}</span>
      <span class="flex-2">{{_formName(data.key.6)}}</span>
      <span class="flex-1">{{_date(data.key.1)}}</span>
    </div>
    <div id="formPanel" hidden$="{{!showForm}}"></div>
  </template>

  <script>
    Polymer({
      is: 'assignment-card',
      behaviors: [
        Polymer.AppLocalizeBehavior
      ],
      properties: {
        showForm: {
          type:Boolean,
          reflectToAttribute: true,
          value:false
        }
      },
      _tap: function(e) {
        var first = this.$.formPanel.firstChild;
        if(!first) {
          var formMap = {
            'eq_form':'eq-form'
          };
          var eleName = formMap[this.data.key[6]];
          if(eleName) {
            var ele = document.createElement(eleName);
            var doc = {'key':this.data.value};
            console.log('append');
            ele.setAttribute('document',JSON.stringify(doc));
            this.$.formPanel.appendChild(ele);
          }
        }
        this.showForm=!this.showForm;
        
      },
      _formName:function(type) {
        var dict = {
          'eq_form':'แบบประเมินความฉลาดทางอารมณ์'
        }
        return dict[type];
      },
      _date:function(ts) {
        var d = new Date();
        d.setTime(ts*-1);
        var str = ("0" + d.getDate()).slice(-2) + "-" + 
          ("0"+(d.getMonth()+1)).slice(-2) + "-" +
          d.getFullYear() + " " + 
          ("0" + d.getHours()).slice(-2) + ":" + 
          ("0" + d.getMinutes()).slice(-2);
        return str;
      },
      attached:function() {
        this.loadResources(this.resolveUrl('../locales.json'));
      }
    });
  </script>
</dom-module>
