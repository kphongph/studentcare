<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-material/paper-material.html">
<link rel="import" href="../../iron-ajax/iron-ajax.html">
<link rel="import" href="../../iron-image/iron-image.html">
<link rel="import" href="studentcare-sdq-query.html">
<link rel="import" href="studentcare-eq-query.html">
<link rel="import" href="studentcare-screening-query.html">

<link href="https://fonts.googleapis.com/css?family=Itim&amp;subset=thai" rel="stylesheet">

<dom-module id="studentcare-report">
  <template>
    <style>
      /* ---font---- */
      .font-face-big {
        font-family: 'Itim', cursive;
        font-size: 120%;
        text-decoration: underline;
      }

      .font-face-big-bold {
        font-family: 'Itim', cursive;
        font-size: 120%;
        font-weight: bold;
      }

      .student-info {
        padding: 10px;
        height:40px;
      }

      /* ---image---- */
      #example-full-width-container {
        width: 40px;
      }

      #example-full-width {
        width: 100%;
        --iron-image-width: 100%;
      }

      /* ---table---- */
      :host {
        display: block;
        box-sizing: border-box;
      }

      .center-layout{
        @apply(--layout-center);
        @apply(--layout);
      }

      .horizontal {
        @apply(--layout-horizontal);
      }
      
      .vertical {
        @apply(--layout-vertical);

      }
        
      .header {
        background-color: #F44336;
        text-align:left;
        color: #fff;
        font-family: 'Itim', cursive;
        font-size: 16px;
        height:60px;
      }

      .caption {
        text-align:left;
        color: #000;
        opacity: 0.87;
        height:48px;
        border-bottom-width:1px;
        border-bottom-style:solid;
        border-bottom-color: var(--divider-color);
      }

      .content {
        text-align:left;
        color: #000;
        font-family: 'Itim', cursive;
        font-size: 14px;
        height:50px;
        opacity: 0.50;
      }

      .margin-left-style{
        margin-left:24px;
      }

      .margin-right-style{
        margin-right:24px;
      }

      .flex-3 {
        @apply(--layout-flex-3); 
      }
      .flex-5 {
        @apply(--layout-flex-5); 
      }
      .flex-8 {
        @apply(--layout-flex-8); 
      }
      .flex-10 {
        @apply(--layout-flex-10); 
      }    
    </style>

    <studentcare-sdq-query host="{{host}}" 
       cid="{{cid}}" 
       year="{{year}}"
       document="{{report}}">
    </studentcare-sdq-query>

    <studentcare-eq-query host="{{host}}" 
       cid="{{cid}}" 
       year="{{year}}"
       document="{{eq}}">
    </studentcare-eq-query>

    <studentcare-screening-query host="{{host}}" 
       cid="{{cid}}" 
       year="{{year}}"
       document="{{screening}}">
    </studentcare-screening-query>

    <template is="dom-if" if="{{hasPlan}}">
      <!-- แสดงรายละเอียด -->    
      <div class="student-info">
        <span class="font-face-big-bold"> เลขประจำตัวประชาชน  &nbsp;&nbsp;</span>
        <span class="font-face-big">{{cid}}</span>
        <span class="font-face-big-bold">&nbsp;&nbsp;&nbsp;ชื่อ - นามสกุล &nbsp;&nbsp;</span>
        <span class="font-face-big">{{eq.student.name}}</span>
      </div>

      <paper-material>
        <div class="vertical">
          <div class="horizontal header center-layout">
              <div class="margin-left-style font-face-big-bold">แบบคัดกรอง SDQ</div>
          </div>
          <div class="horizontal caption center-layout">
            <div class="flex-10 center-layout margin-left-style font-face-big-bold">ด้าน</div>
            <div class="flex-5 center-layout margin-left-style font-face-big-bold">ผลการประเมิน</div>
          </div>
          <!-- ถ้ามีผลการประเมิน SDQ --> 
          <template is="dom-if" if="{{hasSDQ}}"> 
            <template is="dom-repeat" items="{{sdq}}" as="data">
                <div class="horizontal content center-layout">
                  <div class="flex-10 center-layout margin-left-style font-face-big-bold">{{data.label}}</div>
                  <div class="flex-5 center-layout margin-left-style font-face-big-bold">
                    <template is="dom-if" if="{{!data.chk}}">
                      {{data.result}}
                    </template>
                    <div id="example-full-width-container">
                      <template is="dom-if" if="{{data.chk}}">
                        <iron-image id="example-full-width" src="{{data.result}}"></iron-image>
                      </template>
                    </div>
                  </div>
                </div>
            </template>
          </template>
           <!-- ถ้าไม่มีผลการประเมิน SDQ --> 
          <template is="dom-if" if="{{!hasSDQ}}">
             <div class="content center-layout margin-left-style font-face-big-bold">ยังไม่มีการประเมิน</div>
          </template>
        </div>

        <div class="vertical">
          <div class="horizontal header center-layout">
              <div class="margin-left-style font-face-big-bold">แบบคัดกรองนักเรียนรายบุคคล</div>
          </div>
          <div class="content center-layout margin-left-style font-face-big-bold">ยังไม่มีการประเมิน</div>
        </div>

        <div class="vertical">
          <div class="horizontal header center-layout">
              <div class="margin-left-style font-face-big-bold">แบบคัดกรอง EQ</div>
          </div>
          <!-- ถ้ามีผลการประเมิน EQ --> 
          <template is="dom-if" if="{{hasEQ}}">
            <div class="margin-left-style horizontal content center-layout">
              <div id="example-full-width-container"><iron-image id="example-full-width" src="{{eqResult.0.emo}}"></iron-image></div>
              <div class="center-layout margin-left-style font-face-big-bold">{{eqResult.0.text}}</div>
            </div>
          </template>
          <!-- ถ้าไม่มีผลการประเมิน EQ --> 
          <template is="dom-if" if="{{!hasEQ}}">
             <div class="content center-layout margin-left-style font-face-big-bold">ยังไม่มีการประเมิน</div>
          </template>
        </div>
      </paper-material>
    </template>
  </template>

  <script>
    Polymer({
      is: 'studentcare-report',
      properties: {
          cid:String,
          host:String,
          year:String,
          /*name:{
            type:String,
            computed:'___Name(report,eq,screening)'
          },*/
          sdq:{
            type:Object,
            notify: true,
            computed:'___sdqResult(report)'
          },
          eqResult:{
            type:Object,
            notify: true,
            computed:'___eqResult(eq)'
          },
          result:{
            type:Object,
            notify: true,
            computed:'___result(screening)'
          },
          hasPlan: {
            type:Boolean,
            value: false,
            notify:true
          },
          hasSDQ: {
            type:Boolean,
            value: false,
            notify:true
          }
          ,
          hasEQ: {
            type:Boolean,
            value: false,
            notify:true
          }
          ,
          hasPersonal: {
            type:Boolean,
            value: false,
            notify:true
          }
      },
      /*___Name(report,eq,screening){
        var fname;
        console.log(this.report.student.name);
        console.log(this.eq.student.name);
        console.log(this.screening.student.name);
      },*/
      ___eqResult(eq){
        var chkEQ = this.eq.form_result.score;
        console.log(chkEQ);
        var eq_score=[];
        if(chkEQ > 56){
          eq_score.push({"emo":'../images/green.png',"text":'ความฉลาดทางอารมณ์สูงกว่าปกติ'});
        }else if(chkEQ > 42 && chkEQ <= 56){
          eq_score.push({"emo":'../images/yellow.png',"text":'ความฉลาดทางอารมณ์ปานกลาง'});
        }else{
          eq_score.push({"emo":'../images/red.png',"text":'ความฉลาดทางอารมณ์ต่ำกว่าปกติ'});
        }
        console.log(eq_score);
        this.set('hasPlan',true);
        this.set('hasEQ',true);
        return eq_score;
      },
      ___result(screening){
        console.log(this.screening);
      },
      ___sdqResult(report) {
		  //console.log(this.report.form_result);
		  var emotion = this.report.form_result.emotion;
      var behavior = this.report.form_result.behavior;
      var behavior_active = this.report.form_result.behavior_active;
      var friend = this.report.form_result.friend;
      var social = this.report.form_result.social;
      var weakness = this.report.form_result.weakness;
      var back = this.report.form_result.back;
      var tmp = [];
      tmp.push({"label":emotion.label,"result":emotion.result},
      {"label":behavior.label,"result":behavior.result},
      {"label":behavior_active.label,"result":behavior_active.result},
      {"label":friend.label,"result":friend.result},
      {"label":social.label,"result":social.result},
      {"label":weakness.label,"result":weakness.result},
      {"label":back.label,"result":back.result});
      //console.log(tmp);
      var img;
      var chk;
      var data = [];
      for(var i=0;i<tmp.length;i++) {
        var chkResult = tmp[i].result;
        //console.log(chkResult);
        if(chkResult=="ปกติ"){
          img="../images/green.png";
          chk=true;
        }else if(chkResult=="เสี่ยง"){
          img="../images/yellow.png";
          chk=true;
        }else if(chkResult=="มีปัญหา"){
          img="../images/red.png";
          chk=true;
        }else{
          img=chkResult;
          chk=false;
        }
        data.push({"label":tmp[i].label,"result":img,"chk":chk});
		  }
      console.log(data);
      this.set('hasPlan',true);
      this.set('hasSDQ',true);
		  return data;
	   }
    });
  </script>
</dom-module>
