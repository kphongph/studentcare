<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../iron-icons/iron-icons.html">
<link rel="import" href="../../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../../paper-styles/typography.html">
<link rel="import" href="../../paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../form-control.html">
<link rel="import" href="../studentcare-form-behavior.html">

<dom-module id="screening-elementary-form">
  <template>
    <style include="iron-flex iron-flex-alignment iron-flex-factors">

      :host {
        @apply(--paper-font-display);
        @apply(--layout-vertical);
        display: block;
      }

      .invalid {
        border: 1px solid #ee0000;
      }

      .formEntry div {
        @apply(--paper-font-display);
        margin:3px;
        padding:0px;
      }

      .evaluation {
        padding:5px;
      }
      
      .sub-question {
        padding-left:20px;
      }

      .topic1 {
        padding:20px;
        margin-right:20px;
        @apply(--layout-vertical);
      }
      
      .topic1 paper-input {
        margin-left:50px;
      }

      .topic1 paper-checkbox {
        margin-top:10px;
      }

      .check-icon {
        width:30px;
      }
    </style>

    <form-control id="control" 
      on-form-action="_tap" 
      doc-key="{{document.key}}"
      doc-value="{{document.value}}">
      <div class="description">
        <ol class="num"><b> คำชี้แจง</b>
         <li>ให้เลือกว่าอาการในแต่ละข้อนั้นตรงกับลักษณะของเด็กที่ท่านประเมินเพียงใด</li>
        </ol>
      </div>
      <div class="formEntry">
       <ol>
         <li>
           <label id="label1">ความสามารถพิเศษ (ความถนัดและความสนใจในวิชาที่เรียน)</label>
           <paper-radio-group aria-labelledby="label1" selected="{{document.value.form_value.q1}}">
             <paper-radio-button name="y">มี</paper-radio-button>
             <paper-radio-button name="n">ไม่มี</paper-radio-button>
           </paper-radio-group>
           <div class="topic1" hidden$="{{!_isEquals(document.value.form_value.q1,'y')}}">

             <paper-checkbox checked="{{document.value.form_value.q1_1}}">
             กลุ่มสาระการเรียนรู้คณิตศาสตร์ 
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_1_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_1}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_1_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_1}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_2}}">
             กลุ่มสาระการเรียนรู้ภาษาไทย
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_2_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_2}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_2_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_2}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_3}}">
             กลุ่มสาระการเรียนรู้ภาษาต่างประเทศ
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_3_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_3}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_3_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_3}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_4}}">
             กลุ่มสาระการเรียนรู้วิทยาศาสตร์
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_4_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_4}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_4_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_4}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_5}}">
             กลุ่มสาระการเรียนรู้ศิลปะ
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_5_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_5}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_5_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_5}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_6}}">
             กลุ่มสาระการเรียนรู้การงานอาชีพและเทคโนโลยี
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_6_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_6}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_6_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_6}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_7}}">
             กลุ่มสาระการเรียนรู้สุขศึกษาและพลศึกษา
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_7_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_7}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_7_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_7}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_8}}">
             กลุ่มสาระการเรียนรู้สังคมศึกษา ศาสนา และวัฒนธรรม
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_8_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_8}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_8_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_8}}">
             </paper-input>

             <paper-checkbox checked="{{document.value.form_value.q1_9}}">
             อื่น ๆ
             </paper-checkbox>
             <paper-input value="{{document.value.form_value.q1_9_t1}}" 
               label="ลำดับที่ 1"
               disabled="{{!document.value.form_value.q1_9}}">
             </paper-input>
             <paper-input value="{{document.value.form_value.q1_9_t2}}"
               label="ลำดับที่ 2"
               disabled="{{!document.value.form_value.q1_9}}">
             </paper-input>

           </div>
         </li>
         <li>
           <label id="label2">ด้านการเรียน</label>
           <paper-input label="ผลการประเมิน" readonly 
             value="{{_q2Text(document.value.form_value.q2)}}"> 
           </paper-input>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_1_m}}">
               ผลการเรียนเฉลี่ย 1.00 - 2.00
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_1_p}}">
               ผลการเรียนเฉลี่ยต่ำกว่า 1.00 
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_2_m}}">
               ติด 0, ร, มส, มผ 1-2 วิชา ต่อ 1 ภาคเรียน
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_2_p}}">
               ติด 0, ร, มส, มผ มากกว่า 2 วิชา ต่อ 1 ภาคเรียน
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_3_m}}">
               ไม่เขัาเรียน 1-2 ครั้ง ต่อ รายวิชา
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_4_m}}">
               มาเรียนสาย 3 ครั้งต่อสัปดาห์
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_4_p}}">
               มาเรียนสายมากกว่า 3 ครั้งต่อสัปดาห์
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_5_m}}">
               ไม่ตั้งใจเรียนขณะครูสอน
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_5_p}}">
               ไม่เข้าเรียนหลายครั้งโดยไม่มีเหตุจำเป็น
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_6_m}}">
               ไม่มีอุปกรณ์การเรียนมาเรียนหรือนำอุปกรณ์การเรียนมาไม่ครบ 
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_6_p}}">
               สมาธิสั้น
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_7_m}}">
                อ่านสะกดคำไม่ได้
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_7_p}}">
                ขาดเรียนบ่อยมากกว่า 1 วันต่อสัปดาห์
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_8_m}}">
                 จับใจความสำคัญไม่ได้
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_9_m}}">
                 เขียนตัวอักษรไม่ได้
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_10_m}}">
                อ่านไม่ได้ใจความ
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_11_m}}">
                ไม่ส่งงาน 1-2 วิชา
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_11_p}}">
               ไม่ส่งงานมากกว่า 2 วิชา
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_12_m}}">
                ไม่ผ่านคุณลักษณะอันพึงประสงค์ 1 ข้อ
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_12_p}}">
               ไม่ผ่านคุณลักษณะอันพึงประสงค์ตั้งแต่ 2 ข้อขึ้นไป
             </paper-checkbox>
           </div>
           <div class="layout horizontal">
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_13_m}}">
                ผลการประเมินการอ่านคิดวิเคราะห์และเขียนสื่อความอยู่ในระดับ 1
             </paper-checkbox>
             <paper-checkbox class="flex-1" checked="{{document.value.form_value.q2_13_p}}">
                ผลการประเมินการอ่านคิดวิเคราะห์และเขียนสื่อความไม่ผ่าน
             </paper-checkbox>
           </div>
         </li>
       </ol>
     </div>

     <div class="evaluation">
      <!--
      <div class="layout vertical">
       <div class="layout horizontal">
        <div class="check-icon">
          <iron-icon icon="check" hidden$="{{!_mark}}">
          </iron-icon>
        </div>
        <span class="flex" id="markPositive">
          พบความบกพร่อง
        </span>
       </div>
       <div class="layout horizontal">
        <div class="check-icon">
          <iron-icon icon="check" hidden$="{{_mark}}">
          </iron-icon>
        </div>
        <span class="flex" id="markNegative">
          ไม่พบความบกพร่อง
        </span>
       </div>
      </div>
      -->
      ไม่มีหลักเกณฑ์
     </div>
    </form-control>

  </template>

  <script>
    Polymer({
      is: 'screening-elementary-form',
      listeners : {
      },
      properties: {
        name: {
          type:String,
          reflectToAttribute:true,
          value:"แบบคัดกรองนักเรียนรายบุคคล ระดับประถม"
        }
      },
      behaviors:[
        Polymer.IronValidatableBehavior,
        StudentcareFormBehavior,
      ],
      observers:[
        '_result(document.value.form_result)',
        '_monitor(document.value.form_value.*)',
      ],
      _tap:function(e) {
        if(e.detail.type == "save") {
          this.$.control.save();
        }
      },
      _q2Text:function(q2) {
        if(q2=='p') {
          return 'มีปัญหา';
        } else {
          if(q2=='m') {
            return 'เสี่ยง';
          }
        }
      },
      _monitor:function(changeRecord) {
        if(!this.document.value) return;
        var tmp = this.document.value.form_value;
        var current_max = '';
        for(var q in tmp) { 
          var qs = q.split('_');
          if(qs[0] =='q2' && tmp[q]) {
            if(qs[2] == 'p') { 
              current_max = 'p';
            } else {
              if(current_max != 'p') {
                current_max = qs[2];
              }
            }
          }
        }
        this.set('document.value.form_value.q2',current_max);
      },
      _evaluate:function() {
        var values = this.document.value.form_value;
        var score = {};
        for(var q in values) {
          var p = q.split('_')[0];
          if(!score[p]) score[p] = {'y':0,'n':0};
          score[p][values[q]]++;
        }
        return score;
      },
      _validate:function() {
        var eles =Polymer.dom(this.root)
         .querySelectorAll('snap-choice');
        for(var i=0;i<eles.length;i++) {
          if(!eles[i].value)  {
            console.log(eles[i]);
            eles[i].classList.add('invalid');
            return false;
          } else {
            eles[i].classList.remove('invalid');
          }
        }
        return true;
      },
      _isEquals:function(a,b) {
        return a != null && a == b ;
      },
      _reset:function() {
        this.set('document.value.form_value',{});        
      },
      _result:function(score) {
        /*
        if(!score) return;
        var foundSub = false; 
        for(var key in score) {
          if(key.indexOf('s') == 0 && score[key].y>=2) {
            foundSub=true;
            break;
          }
        }
        if(score.p1.y >= 1  && foundSub) {
          this.$$('#markPositive').classList.add('mark');
          this.$$('#markNegative').classList.remove('mark');
          this.set('_mark',true);
        } else {
          this.$$('#markNegative').classList.add('mark');
          this.$$('#markPositive').classList.remove('mark');
          this.set('_mark',false);
        }
        */
      }
    });
  </script>
</dom-module>
