<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../app-storage/app-localstorage/app-localstorage-document.html">

<link rel="import" href="progress-by-room.html">
<link href="https://fonts.googleapis.com/css?family=Itim&amp;subset=thai" rel="stylesheet">

<dom-module id="student-room">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors">
       :host {
        @apply(--layout-vertial);
      }

      paper-item {
        border-bottom: 1px solid var(--paper-grey-500);
        /*สีเส้นระหว่างกล่องสีเส้นด้ารล่าง*/
      }

      paper-item-body {
        --paper-item-body-two-line-min-height: 48px;
        /*ความกว้างของกล่องชื่อเด็กแต่ละคน*/
      }

      .icon-name {
        display: inline-block;
        height: 36px;
        width: 36px;
        border-radius: 50%;
        background: #f44336;
        line-height: 36px;
        font-size: 18px;
        color: #ffffff;
        text-align: center;
        margin-right: 15px;
      }

      .font-face {
        font-family: 'Itim', cursive;
      }
    </style>

    <app-localstorage-document key="jwtToken" data="{{jwtToken}}">
    </app-localstorage-document>

    <iron-ajax id="listAjax"
       method="POST"
       url="https://maas.nuqlis.com:8000/v2/obec/student_data_db/query"
       content-type="application/json"
       headers$='{"Authorization":"JWT {{jwtToken.token}}"}'
       last-response="{{students}}"
       body$='{"query":{"class":"{{level}}","room":"{{room}}","year":{{year}},"hostid":"{{host}}"}}'>
    </iron-ajax>

    <paper-listbox selected="{{student}}" on-iron-select="_selected" attr-for-selected="name">
      <template is="dom-repeat" items="{{students}}">
        <paper-item name="{{item._id}}">
          <!--<div class="avatar" slot="item-icon"></div>-->
          <div class="icon-name font-face">{{_firstLetter(item.name)}}</div>
          <!--{{_firstLetter(item.key.4.2)}}-->
          <paper-item-body two-line>
            <div class="font-face">{{item.name}} {{item.lastname}}</div>
            <div secondary class="font-face">{{item.cid}}</div>
          </paper-item-body>
          <paper-icon-button icon="star" alt="favourite this!">
          </paper-icon-button>
        </paper-item>
      </template>
    </paper-listbox>
    <!--
    <progress-by-room year="{{year}}" level="{{level}}" room="{{room}}" host="{{host}}" url="http://202.143.174.205:3000/view">
    </progress-by-room>
    -->
  </template>

  <script>
    Polymer({
      is: 'student-room',
      properties: {
        host: String,
        level: String,
        room: String,
        year: String
      },
      observers: [
        '__execute(jwtToken,host,level,room,year)',
      ],
      __execute: function (jwtToken, host, level, room,year) {
	if(jwtToken == null || host == null || level == null
           || year == null || level.length == 0 || room.length == 0
	   || room == null) return;
        this.$.listAjax.generateRequest();
      },
      _firstLetter: function (str) {
        return str[0];
      },
      _selected: function (e) {
        this.fire('student-selected', { '_id': this.student});
      }
    });
  </script>
</dom-module>
