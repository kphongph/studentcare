<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../app-layout/app-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="student-room.html">
<link rel="import" href="student-form.html">

<!--
`studentcare-components`
Polymer Component for StudentCare project

@demo demo/index.html 
-->

<dom-module id="studentcare-app">
  <template>
   <style include="iron-flex iron-flex-alignment iron-flex-factors">
      :host {
        @apply(--layout-vertical);
        display: block;
      }
      app-toolbar {
        background-color:var(--paper-red-500);
        color:white;
      }
   </style>

   <app-toolbar>
      <paper-icon-button icon="arrow-back" hidden$="{{_isEqual(page,0)}}"
        on-tap="_back">
      </paper-icon-button>
     <div main-title>แบบประเมิน</div>
   </app-toolbar>

   <iron-pages selected="{{page}}">
    <student-room year="{{year}}"
      host="{{host}}"
      level="{{level}}"
      room="{{room}}">
    </student-room>
    <student-form db="{{db}}" key="{{key}}" year="{{year}}">
    </student-form>
    <div id="formEntry">
    </div>
   </iron-pages>

  </template>

  <script>
    Polymer({
      is: 'studentcare-app',
      properties: {
        host:String,
        level:{
          type:String
        },
        room:{
          type:String
        },
        page: {
          type:Number, 
          readOnly:true,
          value:0
        }
      },
      listeners:{
       'student-selected':'_selectStudent',
       'select-assignment':'_selectAssignment'
      },
      _selectStudent:function(e) {
        this.set('db',e.detail.db);
        this.set('key',e.detail._id);
        this._setPage(1);
      },
      _selectAssignment:function(e) {
        var node = this.$.formEntry;
        while(node.firstChild) {
          node.removeChild(node.firstChild);
        }
        var formElement = e.detail.formElement;
        this.$.formEntry.appendChild(formElement);
        this._setPage(2);
      },
      _back:function() {
        this._setPage(this.page - 1);
      },
      _isEqual:function(page,num) {
        return page == num;
      }
     
    });
  </script>
</dom-module>
